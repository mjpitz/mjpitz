12factor:
  nameOverride: go

  image:
    repository: img.pitz.tech/mya/pages
    tag: latest@sha256:724dc7923ee35997f36623a1e18a5e94a7835134cbca042b162d4704600849b6

  deployment:
    replicaCount: 2

    application:
      envFrom:
        - secretRef:
            name: pages-secret
      ports:
        - name: http
          containerPort: 8080
          protocol: TCP
        - name: debug
          containerPort: 8081
          protocol: TCP

  networking:
    service:
      ports:
        - name: http
          targetPort: http
          protocol: TCP
          port: 8080
        - name: debug
          targetPort: debug
          protocol: TCP
          port: 8081

    ingress:
      enabled: true
      annotations:
        kubernetes.io/ingress.class: nginx
        kubernetes.io/tls-acme: "true"
        cert-manager.io/cluster-issuer: "letsencrypt-prod"
        external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
        nginx.ingress.kubernetes.io/enable-cors: "true"
        nginx.ingress.kubernetes.io/ssl-redirect: "true"
        nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
        nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
        nginx.ingress.kubernetes.io/connection-proxy-header: "keep-alive,Upgrade"
        nginx.ingress.kubernetes.io/configuration-snippet: |
          proxy_set_header Upgrade "websocket";
      hosts:
        - host: go.pitz.tech
          paths:
            - path: /
              pathType: Prefix
      tls:
        - secretName: pages-tls
          hosts:
            - go.pitz.tech

metrics:
  serviceMonitor:
    interval: 10s
