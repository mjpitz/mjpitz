<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo><head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v3.0.5"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://mjpitz.com/blog/2020/09/21/protobuf-experience/"><!-- Primary Meta Tags --><title>Working with Protocol Buffers</title><meta name="title" content="Working with Protocol Buffers"><meta name="description" content=""><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://mjpitz.com/blog/2020/09/21/protobuf-experience/"><meta property="og:title" content="Working with Protocol Buffers"><meta property="og:description" content=""><meta property="og:image" content="https://mjpitz.com/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://mjpitz.com/blog/2020/09/21/protobuf-experience/"><meta property="twitter:title" content="Working with Protocol Buffers"><meta property="twitter:description" content=""><meta property="twitter:image" content="https://mjpitz.com/blog-placeholder-1.jpg"><link rel="stylesheet" href="/_astro/_...slug_.e98600b1.css" />
<style type="text/css">main[data-astro-cid-bvzihdzo]{width:calc(100% - 2em);max-width:100%;margin:0}.hero-image[data-astro-cid-bvzihdzo]{width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.prose[data-astro-cid-bvzihdzo]{width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:var(--color-text)}.title[data-astro-cid-bvzihdzo]{margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:var(--color-text)}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}
</style><script type="module">const t=document.querySelector('.theme-switch input[type="checkbox"]'),e=localStorage.getItem("theme");e&&(document.documentElement.setAttribute("data-theme",e),e==="dark"&&(t.checked=!0));function m(c){c.target.checked?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))}t.addEventListener("change",m,!1);
</script></head><body data-astro-cid-bvzihdzo><header data-astro-cid-3ef6ksr2><nav data-astro-cid-3ef6ksr2><div class="theme-switch-wrapper"><label class="theme-switch" for="checkbox"><input type="checkbox" id="checkbox"><div class="slider"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#FCD53F" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#FCD53F" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></div></label></div><h2 data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2>Mya Pitzeruse</a></h2><div class="internal-links" data-astro-cid-3ef6ksr2><a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Home</a><a href="/blog" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Blog</a><a href="/charts" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Charts</a><a href="/media" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Media</a><a href="/papers" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg>Papers</a></div><div class="social-links" data-astro-cid-3ef6ksr2><a href="https://github.com/mjpitz" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>GitHub</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-3ef6ksr2></path></svg></a><a href="https://www.linkedin.com/in/mjpitz/" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>LinkedIn</span><svg viewBox="0 0 50 50" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z" data-astro-cid-3ef6ksr2></path></svg></a><a href="/rss.xml" target="_blank" data-astro-cid-3ef6ksr2><span class="sr-only" data-astro-cid-3ef6ksr2>RSS</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-3ef6ksr2><path fill="currentColor" d="M1,5v2c1.081,0,2.128,0.211,3.113,0.628c0.952,0.403,1.808,0.98,2.543,1.715s1.312,1.591,1.715,2.543 C8.789,12.872,9,13.919,9,15h2C11,9.477,6.523,5,1,5z M4,10c-1.105,0-2,0.895-2,2s0.895,2,2,2s2-0.895,2-2S5.105,10,4,10z M1,1v2 c1.621,0,3.192,0.317,4.67,0.942c1.429,0.604,2.712,1.47,3.815,2.573c1.103,1.103,1.968,2.386,2.573,3.815 C12.683,11.808,13,13.379,13,15h2C15,7.268,8.732,1,1,1z" data-astro-cid-3ef6ksr2></path></svg></a></div></nav></header><main data-astro-cid-bvzihdzo><article data-astro-cid-bvzihdzo><div class="hero-image" data-astro-cid-bvzihdzo><img width="1020" height="510" src="/img/blog-placeholder-5.jpg" alt="" data-astro-cid-bvzihdzo></div><div class="prose" data-astro-cid-bvzihdzo><div class="title" data-astro-cid-bvzihdzo><div class="date" data-astro-cid-bvzihdzo><time datetime="2020-09-21T00:00:00.000Z">Sep 21, 2020</time></div><h1 data-astro-cid-bvzihdzo>Working with Protocol Buffers</h1><hr data-astro-cid-bvzihdzo></div><p>Google’s <a href="https://developers.google.com/protocol-buffers/docs/">Protocol Buffers</a> can be a power piece of technology.
Yet, I often feel they are undervalued, underutilized, and underappreciated.
Since joining <a href="https://www.indeed.com">Indeed</a> back in 2013, I’ve had a fair amount of experience working with them.
<a href="https://engineering.indeedblog.com/blog/2012/12/boxcar-self-balancing-distributed-services-protocol/">Boxcar</a> (Indeed’s distributed services framework) was built on protocol buffers.
As a previous maintainer of Boxcar, I’ve had hands on experience with low level components of protocol buffers.
In this post, I discuss many of the benefits to using the technology.</p>
<!--more-->
<p>Over the last decade, I’ve written services of different shapes and forms.
In college, I started writing RESTful services using PHP and CodeIgniter.
Over time, I switched to C# and continued with RESTful patterns.
It wasn’t until I started working at Indeed that I was first exposed to protocol buffers.</p>
<h2 id="language-agnostic-contract">Language agnostic contract</h2>
<p>My first exposure to Protocol Buffers was in Indeed’s Boxcar framework.
The first benefit I saw was the language agnostic contract.
Back then, I worked regularly between JavaScript and Java regularly.
Having a technology that wasn’t specifically tied to any language was promising.</p>
<p>This contract defines the services and methods available, as well as the messages used throughout.
Versioning is the responsibility of authors and is often built into the package.
For example, <code>company.application.v1beta</code> or <code>project.v1beta.resource</code>.
This contract is also extensible.
We can provide custom extensions to enrich the contract and add metadata.</p>
<h2 id="grpc-rest-and-swagger">gRPC, REST, and swagger</h2>
<p>I’m a long time supporter of <a href="https://grpc.io/">gRPC</a>.
I think it’s been a great addition to open source, and the suite of tools surrounding it shows.
For example, <a href="https://github.com/grpc-ecosystem/grpc-gateway">grpc-gateway</a> makes it easy for gRPC processes to expose RESTful interfaces.
It works by annotating protocol buffer services with RESTful routing semantics.
We can provide these annotations inline or in an external yaml file.</p>
<pre is:raw="" class="astro-code github-dark" style="background-color: #24292e; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color: #85E89D">type</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">google.api.Service</span></span>
<span class="line"><span style="color: #85E89D">config_version</span><span style="color: #E1E4E8">: </span><span style="color: #79B8FF">3</span></span>
<span class="line"></span>
<span class="line"><span style="color: #85E89D">http</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">  </span><span style="color: #85E89D">rules</span><span style="color: #E1E4E8">:</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D"># /v1beta/graph</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">## GraphStore</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">### Put</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.Put</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">put</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">body</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"*"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">### Delete</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.Delete</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">delete</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">body</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">"*"</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">### List</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.List</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">get</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.List</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">get</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph/{kind}</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">### Neighbors</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">#### all neighbors</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.Neighbors</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">get</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph/{node.key}/neighbors</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">#### neighbors on the receiving end of edges</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.Neighbors</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">get</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph/{from.key}/neighbors/from</span></span>
<span class="line"><span style="color: #E1E4E8">    </span><span style="color: #6A737D">#### neighbors on the initiating end of edges</span></span>
<span class="line"><span style="color: #E1E4E8">    - </span><span style="color: #85E89D">selector</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">graphstore.api.v1beta.GraphStore.Neighbors</span></span>
<span class="line"><span style="color: #E1E4E8">      </span><span style="color: #85E89D">get</span><span style="color: #E1E4E8">: </span><span style="color: #9ECBFF">/v1beta/graph/{to.key}/neighbors/to</span></span></code></pre>
<p>During compilation, the plugin uses this information to generate code that supports binding gRPC services to an HTTP 1.1 interface.
This same metadata can be used to generate <a href="https://swagger.io/">swagger</a> documentation for an API.
You simply need to modify a single file, and let code generation take care of the REST.</p>
<h2 id="client-generated-code">Client generated code</h2>
<p>Finally, one of the most powerful feature of gRPC and protocol buffers is the ability to code generate clients for many languages.
While there are solutions for taking swagger definitions and generating clients from them, I’ve found issues with many and few support more than one language (well).
This has been one of the core tenants to protocol buffers since it was released in 2008.
Define a service and generate clients or servers for your language.</p>
<p>If you’re contemplating starting a new project, I encourage you to take a look at protocol buffers and gRPC.
These two pieces of technology are essential building blocks I added to my toolkit a long time ago.
With them, I’ve been able to quickly develop prototypes and reduce a lot of boilerplate on new systems.
If you’d like any help getting started, feel free to reach out to me on <a href="https://twitter.com/myajpitz">twitter</a>.</p></div></article></main><footer data-astro-cid-sz7xmlte>
&copy; 2023&nbsp;Mya Pitzeruse. All rights reserved.
<div class="social-links" data-astro-cid-sz7xmlte><a href="https://github.com/mjpitz" target="_blank" data-astro-cid-sz7xmlte><span class="sr-only" data-astro-cid-sz7xmlte>GitHub</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-sz7xmlte><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-sz7xmlte></path></svg></a><a href="https://www.linkedin.com/in/mjpitz/" target="_blank" data-astro-cid-sz7xmlte><span class="sr-only" data-astro-cid-sz7xmlte>LinkedIn</span><svg viewBox="0 0 50 50" aria-hidden="true" width="32" height="32" data-astro-cid-sz7xmlte><path fill="currentColor" d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z" data-astro-cid-sz7xmlte></path></svg></a><a href="/rss.xml" target="_blank" data-astro-cid-sz7xmlte><span class="sr-only" data-astro-cid-sz7xmlte>RSS</span><svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-sz7xmlte><path fill="currentColor" d="M1,5v2c1.081,0,2.128,0.211,3.113,0.628c0.952,0.403,1.808,0.98,2.543,1.715s1.312,1.591,1.715,2.543 C8.789,12.872,9,13.919,9,15h2C11,9.477,6.523,5,1,5z M4,10c-1.105,0-2,0.895-2,2s0.895,2,2,2s2-0.895,2-2S5.105,10,4,10z M1,1v2 c1.621,0,3.192,0.317,4.67,0.942c1.429,0.604,2.712,1.47,3.815,2.573c1.103,1.103,1.968,2.386,2.573,3.815 C12.683,11.808,13,13.379,13,15h2C15,7.268,8.732,1,1,1z" data-astro-cid-sz7xmlte></path></svg></a></div></footer></body></html>