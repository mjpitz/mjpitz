<!DOCTYPE html><html lang="en" data-astro-cid-bvzihdzo> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.9"><!-- Font preloads --><link rel="preload" href="/fonts/atkinson-regular.woff" as="font" type="font/woff" crossorigin><link rel="preload" href="/fonts/atkinson-bold.woff" as="font" type="font/woff" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://mya.sh/blog/2020/08/06/bfs-over-grpc-stream/"><!-- Primary Meta Tags --><title>Implementing Breadth-first Search Over gRPC | Mya Jaye</title><meta name="title" content="Implementing Breadth-first Search Over gRPC | Mya Jaye"><meta name="description" content="deps.cloud is an open source project that I started.
It's a tool that helps companies understand how their projects relate to one another.
While graph databases do exist, finding administrative and engineering support is often hard.
On the other hand, finding support for relational databases is easy.
In this post, I share lessons learned while implementing a graph system on top of common relational databases. 
"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://mya.sh/blog/2020/08/06/bfs-over-grpc-stream/"><meta property="og:title" content="Implementing Breadth-first Search Over gRPC | Mya Jaye"><meta property="og:description" content="deps.cloud is an open source project that I started.
It's a tool that helps companies understand how their projects relate to one another.
While graph databases do exist, finding administrative and engineering support is often hard.
On the other hand, finding support for relational databases is easy.
In this post, I share lessons learned while implementing a graph system on top of common relational databases. 
"><meta property="og:image" content="https://mya.sh/img/blog-placeholder-2.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://mya.sh/blog/2020/08/06/bfs-over-grpc-stream/"><meta property="twitter:title" content="Implementing Breadth-first Search Over gRPC | Mya Jaye"><meta property="twitter:description" content="deps.cloud is an open source project that I started.
It's a tool that helps companies understand how their projects relate to one another.
While graph databases do exist, finding administrative and engineering support is often hard.
On the other hand, finding support for relational databases is easy.
In this post, I share lessons learned while implementing a graph system on top of common relational databases. 
"><meta property="twitter:image" content="https://mya.sh/img/blog-placeholder-2.jpg"><script>
!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys getNextSurveyStep onSessionId".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
posthog.init(
    'phc_iVreaMYf7AssmtgSwxMZy4UP6pWqGY5PDvqWFhbHi5j',
    {
        api_host:'https://us.i.posthog.com',
        person_profiles: 'identified_only'
    }
)
</script><link rel="stylesheet" href="/_astro/_slug_.ycWYyYyU.css">
<style>main[data-astro-cid-bvzihdzo]{width:960px;max-width:calc(100% - 2em);margin:0 auto}div[data-astro-cid-bvzihdzo].prose{width:800px;max-width:calc(100% - 2em);margin:2em auto 0;color:var(--color-text)}.hero-image[data-astro-cid-bvzihdzo]{margin-top:30px;width:100%}.hero-image[data-astro-cid-bvzihdzo] img[data-astro-cid-bvzihdzo]{display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.title[data-astro-cid-bvzihdzo]{margin:2em 0 1em;padding:1em 0;text-align:center;line-height:1}.title[data-astro-cid-bvzihdzo] h1[data-astro-cid-bvzihdzo]{margin:0 0 .5em}.date[data-astro-cid-bvzihdzo]{margin-bottom:.5em;color:var(--color-text)}.last-updated-on[data-astro-cid-bvzihdzo]{font-style:italic}footer[data-astro-cid-bvzihdzo]{padding:2em 1em 6em;color:var(--color-text);text-align:center}.light-dark[data-astro-cid-bvzihdzo]{position:fixed;top:0;left:0;padding:10px}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body data-astro-cid-bvzihdzo> <div class="light-dark" data-astro-cid-bvzihdzo> <div class="theme-switch-wrapper"> <label class="theme-switch" for="checkbox"> <input type="checkbox" id="checkbox"> <div class="slider"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#FCD53F" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"> <circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line> </svg> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="#FCD53F" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path> </svg> </div> </label> <script type="module">const t=document.querySelector('.theme-switch input[type="checkbox"]'),e=localStorage.getItem("theme");e&&(document.documentElement.setAttribute("data-theme",e),e==="dark"&&(t.checked=!0));function m(c){c.target.checked?(document.documentElement.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")):(document.documentElement.setAttribute("data-theme","light"),localStorage.setItem("theme","light"))}t.addEventListener("change",m,!1);</script> </div> </div> <main data-astro-cid-bvzihdzo> <div class="social-links" data-astro-cid-yxtifmrq> <a href="https://linktr.ee/MsMyaJaye" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>Linktree</span> <svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M7.953 15.066c-.08.163-.08.324-.08.486.08.517.528.897 1.052.89h1.294v4.776c0 .486-.404.89-.89.89H6.577a.898.898 0 0 1-.889-.891v-4.774H.992c-.728 0-1.214-.729-.89-1.377l6.96-12.627a1.065 1.065 0 0 1 1.863 0l2.913 5.585-3.885 7.042zm15.945 0-6.96-12.627a1.065 1.065 0 0 0-1.862 0l-2.995 5.586 3.885 7.04c.081.164.081.326.081.487-.08.517-.529.897-1.052.89h-1.296v4.776c.005.49.4.887.89.89h2.914a.9.9 0 0 0 .892-.89v-4.775h4.612c.73 0 1.214-.729.89-1.377z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://github.com/mjpitz" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://www.linkedin.com/in/mjpitz/" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>LinkedIn</span> <svg viewBox="0 0 50 50" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://twitter.com/MsMyaJaye/" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>Twitter</span> <svg viewBox="0 0 310 310" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M302.973,57.388c-4.87,2.16-9.877,3.983-14.993,5.463c6.057-6.85,10.675-14.91,13.494-23.73 c0.632-1.977-0.023-4.141-1.648-5.434c-1.623-1.294-3.878-1.449-5.665-0.39c-10.865,6.444-22.587,11.075-34.878,13.783 c-12.381-12.098-29.197-18.983-46.581-18.983c-36.695,0-66.549,29.853-66.549,66.547c0,2.89,0.183,5.764,0.545,8.598 C101.163,99.244,58.83,76.863,29.76,41.204c-1.036-1.271-2.632-1.956-4.266-1.825c-1.635,0.128-3.104,1.05-3.93,2.467 c-5.896,10.117-9.013,21.688-9.013,33.461c0,16.035,5.725,31.249,15.838,43.137c-3.075-1.065-6.059-2.396-8.907-3.977 c-1.529-0.851-3.395-0.838-4.914,0.033c-1.52,0.871-2.473,2.473-2.513,4.224c-0.007,0.295-0.007,0.59-0.007,0.889 c0,23.935,12.882,45.484,32.577,57.229c-1.692-0.169-3.383-0.414-5.063-0.735c-1.732-0.331-3.513,0.276-4.681,1.597 c-1.17,1.32-1.557,3.16-1.018,4.84c7.29,22.76,26.059,39.501,48.749,44.605c-18.819,11.787-40.34,17.961-62.932,17.961 c-4.714,0-9.455-0.277-14.095-0.826c-2.305-0.274-4.509,1.087-5.294,3.279c-0.785,2.193,0.047,4.638,2.008,5.895 c29.023,18.609,62.582,28.445,97.047,28.445c67.754,0,110.139-31.95,133.764-58.753c29.46-33.421,46.356-77.658,46.356-121.367 c0-1.826-0.028-3.67-0.084-5.508c11.623-8.757,21.63-19.355,29.773-31.536c1.237-1.85,1.103-4.295-0.33-5.998 C307.394,57.037,305.009,56.486,302.973,57.388z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://youtube.com/@MsMyaJaye/" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>YouTube</span> <svg viewBox="0 0 310 310" width="32" height="32" data-astro-cid-yxtifmrq> <g data-astro-cid-yxtifmrq> <path fill="currentColor" d="M297.917,64.645c-11.19-13.302-31.85-18.728-71.306-18.728H83.386c-40.359,0-61.369,5.776-72.517,19.938   C0,79.663,0,100.008,0,128.166v53.669c0,54.551,12.896,82.248,83.386,82.248h143.226c34.216,0,53.176-4.788,65.442-16.527   C304.633,235.518,310,215.863,310,181.835v-53.669C310,98.471,309.159,78.006,297.917,64.645z M199.021,162.41l-65.038,33.991   c-1.454,0.76-3.044,1.137-4.632,1.137c-1.798,0-3.592-0.484-5.181-1.446c-2.992-1.813-4.819-5.056-4.819-8.554v-67.764   c0-3.492,1.822-6.732,4.808-8.546c2.987-1.814,6.702-1.938,9.801-0.328l65.038,33.772c3.309,1.718,5.387,5.134,5.392,8.861   C204.394,157.263,202.325,160.684,199.021,162.41z" data-astro-cid-yxtifmrq></path> </g> </svg> </a> <a href="/rss.xml" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>RSS</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M1,5v2c1.081,0,2.128,0.211,3.113,0.628c0.952,0.403,1.808,0.98,2.543,1.715s1.312,1.591,1.715,2.543 C8.789,12.872,9,13.919,9,15h2C11,9.477,6.523,5,1,5z M4,10c-1.105,0-2,0.895-2,2s0.895,2,2,2s2-0.895,2-2S5.105,10,4,10z M1,1v2 c1.621,0,3.192,0.317,4.67,0.942c1.429,0.604,2.712,1.47,3.815,2.573c1.103,1.103,1.968,2.386,2.573,3.815 C12.683,11.808,13,13.379,13,15h2C15,7.268,8.732,1,1,1z" data-astro-cid-yxtifmrq></path> </svg> </a> </div>  <nav data-astro-cid-pux6a34n> <div class="internal-links" data-astro-cid-pux6a34n> <a href="/" data-astro-cid-pux6a34n="true" data-astro-cid-eimmu3lg> About </a>  <a href="/blog" class="active" data-astro-cid-pux6a34n="true" data-astro-cid-eimmu3lg> Blog </a>  <a href="/charts" data-astro-cid-pux6a34n="true" data-astro-cid-eimmu3lg> Charts </a>  <a href="/media" data-astro-cid-pux6a34n="true" data-astro-cid-eimmu3lg> Media </a>  <a href="/collab" data-astro-cid-pux6a34n="true" data-astro-cid-eimmu3lg> Collaborate </a>  <a href="/ai" data-astro-cid-pux6a34n="true" data-astro-cid-eimmu3lg> AI </a>  </div> </nav>  <div class="hero-image" data-astro-cid-bvzihdzo>  </div> <div class="title" data-astro-cid-bvzihdzo> <h1 data-astro-cid-bvzihdzo>Implementing Breadth-first Search Over gRPC</h1>  <div class="date" data-astro-cid-bvzihdzo> <time datetime="2020-08-06T00:00:00.000Z"> Aug 6, 2020 </time>  </div> <br data-astro-cid-bvzihdzo> <hr data-astro-cid-bvzihdzo> </div> <div class="prose" data-astro-cid-bvzihdzo> <article data-astro-cid-bvzihdzo>  <p><a href="https://deps.cloud">deps.cloud</a> is an open source project that I started.
It’s a tool that helps companies understand how their projects relate to one another.
It does this by parsing files like <code>package.json</code> and storing the contents in a <a href="https://en.wikipedia.org/wiki/Graph_(abstract_data_type)">graph</a>.</p>
<p>While <a href="https://en.wikipedia.org/wiki/Graph_database">graph databases</a> do exist, finding administrative and engineering support is often hard.
To add complexity to this, graph databases come in a variety of flavors.
Since I wanted the workload to be portable, adopting a graph database was a non-starter.</p>
<p>On the other hand, finding support for relational databases is easy.
The problem is that implementing graphs on relational databases tend to be slow.
While there has been previous efforts, I felt <a href="https://grpc.io">gRPC</a> was able to alleviate many of the problems they faced.
In this post, I share lessons I learned while implementing such a graph database.</p>
<!--more-->
<h2 id="the-database-schema">The Database Schema</h2>
<p>Before talking about the service layer, we first need to cover how we store data.
A common approach is to separate the data out into two separate tables.
One table stores the <code>nodes</code>, or entities, of the graph.
The other stores the <code>edges</code>, or associations.
The problem with this approach is that it often complicates the query logic.
In order to get a full picture, you need to join across 3 tables (<code>nodes</code>, <code>edges</code>, and <code>nodes</code> again).</p>
<p>Instead, I decided to store all data (<code>nodes</code> and <code>edges</code>) in a single table.
This was inspired by <a href="https://www.youtube.com/watch?v=VZ-zJEWi-Vo">Dropbox’s EdgeStore</a>.
The schema for <a href="https://www.mysql.com/">MySQL</a> is as follows:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>CREATE TABLE IF NOT EXISTS graphdata(</span></span>
<span class="line"><span>  graph_item_type VARCHAR(55),</span></span>
<span class="line"><span>  k1 VARCHAR(64),</span></span>
<span class="line"><span>  k2 VARCHAR(64),</span></span>
<span class="line"><span>  k3 VARCHAR(64),</span></span>
<span class="line"><span>  encoding TINYINT,</span></span>
<span class="line"><span>  graph_item_data TEXT,</span></span>
<span class="line"><span>  last_modified DATETIME,</span></span>
<span class="line"><span>  date_deleted DATETIME DEFAULT NULL,</span></span>
<span class="line"><span>  PRIMARY KEY (graph_item_type, k1, k2, k3),</span></span>
<span class="line"><span>  KEY secondary (graph_item_type, k2, k1, k3),</span></span>
<span class="line"><span>  KEY (date_deleted)</span></span>
<span class="line"><span>);</span></span></code></pre>
<ol>
<li>When <code>k1 == k2</code>, the row is a node.</li>
<li>When <code>k1 != k2</code>, the row is an edge.</li>
<li>The <code>k3</code> field allows nodes to have multiple edges between them.</li>
<li>Keys have a maximum length to keep the index small.</li>
<li>The <code>secondary</code> key improves performance of queries in the inverse direction.</li>
</ol>
<h2 id="service-definitions">Service Definitions</h2>
<p>Early on, I wanted a very straight forward interface.
In some of my previous work, the data felt more like key/value data.
I often used bulk updates or bulk deletes to manage my information.
Scanning the data was a semi-common task.
Finally, I needed to do prefix scans on both indexes.
That is:</p>
<ul>
<li><code>k1, k2</code> when querying for the egress (upstream) edges.</li>
<li><code>k2, k1</code> when querying for the ingress (downstream) edges.</li>
</ul>
<p>As a result, I wound up with a pretty minimal key/value interface.
While small, it provides the necessary building blocks for other calls.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="proto"><code><span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> PutRequest</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> PutResponse</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> DeleteRequest</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> DeleteResponse</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> ListRequest</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> ListResponse</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> FindRequest</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> FindResponse</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">service</span><span style="color:#B392F0"> GraphStore</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> Put</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">PutRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">PutResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> Delete</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">DeleteRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">DeleteResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> List</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">ListRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">ListResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">  // neighbors</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> FindUpstream</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">FindRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">FindResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> FindDownstream</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">FindRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">FindResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>In addition to the key/value interface, I needed away to query the graph efficiently.
I started by implementing topological sorting as a client-only feature.
The problem was this required constant communication between the client and server.
This pushed me more towards a stream-based API.
gRPC provides three different types of streaming calls:</p>
<ol>
<li>Client (eg. file upload)</li>
<li>Server (eg. file download)</li>
<li>Bidirectional (eg. chat app)</li>
</ol>
<p>For this use case, either a server or bidirectional streaming API would work.
The main goal is to reduce the amount of back and forth between the clients.
In many traversal algorithms you usually start with a set of nodes, and a strategy to apply.</p>
<p>For example, consider <a href="https://en.wikipedia.org/wiki/Breadth-first_search">breadth-first search</a>.
Engineers often use it to navigate <a href="https://en.wikipedia.org/wiki/Tree_(data_structure)">tree</a> and graph based data structures.
It works by taking a starting node, traversing its children, and repeating the process for each child.
What we see here is that we start with a single request that quickly turns into a lot of data.
Hence, the server streaming capability.</p>
<p>In my implementation, I chose a bidirectional stream.
The reason is these search algorithms often terminate early once it finds the node.
I wanted clients to be able to send along a stop request to prevent any further queries.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="proto"><code><span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> SearchRequest</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"><span style="color:#F97583">message</span><span style="color:#B392F0"> SearchResponse</span><span style="color:#E1E4E8"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">service</span><span style="color:#B392F0"> SearchService</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> BreadthFirstSearch</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">stream</span><span style="color:#B392F0"> SearchRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">stream</span><span style="color:#B392F0"> SearchResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  rpc</span><span style="color:#B392F0"> DepthFirstSearch</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">stream</span><span style="color:#B392F0"> SearchRequest</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">returns</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">stream</span><span style="color:#B392F0"> SearchResponse</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="implementing-breadth-first-search">Implementing Breadth-first Search</h2>
<p>In my opinion, breadth-first search is the easier of the two functions.
<a href="https://en.wikipedia.org/wiki/Depth-first_search">Depth-first search</a> requires further conversation around ordering and how that impacts the results.</p>
<p>In this section, I’m going to use an in-memory map to represent the graph.
You can imagine this being swapped out with the <code>GraphStore</code> interface.
Before we introduce streaming concepts to the code, lets start with an iterative BFS.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> bfs</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">	graph </span><span style="color:#F97583">:=</span><span style="color:#F97583"> map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">][]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">		"a"</span><span style="color:#E1E4E8">: {</span><span style="color:#9ECBFF">"b"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"c"</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#9ECBFF">		"b"</span><span style="color:#E1E4E8">: {</span><span style="color:#9ECBFF">"c"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"d"</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#9ECBFF">		"c"</span><span style="color:#E1E4E8">: {</span><span style="color:#9ECBFF">"e"</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#6A737D">		// ....</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	current </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">}</span></span>
<span class="line"><span style="color:#E1E4E8">	results </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">([]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8"> length </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(current); length </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; length </span><span style="color:#F97583">=</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(current) {</span></span>
<span class="line"><span style="color:#E1E4E8">		next </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">([]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		for</span><span style="color:#E1E4E8"> _, node </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> current {</span></span>
<span class="line"><span style="color:#E1E4E8">			next </span><span style="color:#F97583">=</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">(next, graph[node]</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">		results </span><span style="color:#F97583">=</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">(results, current</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">		current </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> next</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>An iterative solution is key here.
It allows you to buffer and discard layers, thus keeping memory requirements low.
While there are a few inefficiencies in the code, it illustrates the overall structure.
Next, we can introduce the streaming concepts.
In introducing these, we no longer need to track the <code>results</code> of a function.
Instead, we can write the current tier out to the client as we go.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">type</span><span style="color:#B392F0"> ServerStreamingCall</span><span style="color:#F97583"> interface</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">	Send</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">response</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">error</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> bfs</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">call</span><span style="color:#B392F0"> ServerStreamingCall</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">	graph </span><span style="color:#F97583">:=</span><span style="color:#F97583"> map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">][]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">		"a"</span><span style="color:#E1E4E8">: {</span><span style="color:#9ECBFF">"b"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"c"</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#9ECBFF">		"b"</span><span style="color:#E1E4E8">: {</span><span style="color:#9ECBFF">"c"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"d"</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#9ECBFF">		"c"</span><span style="color:#E1E4E8">: {</span><span style="color:#9ECBFF">"e"</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#6A737D">		// ....</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">	current </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> []</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">{</span><span style="color:#9ECBFF">"a"</span><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8"> length </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(current); length </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; length </span><span style="color:#F97583">=</span><span style="color:#B392F0"> len</span><span style="color:#E1E4E8">(current) {</span></span>
<span class="line"><span style="color:#E1E4E8">		next </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> make</span><span style="color:#E1E4E8">([]</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">		for</span><span style="color:#E1E4E8"> _, node </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> current {</span></span>
<span class="line"><span style="color:#E1E4E8">			next </span><span style="color:#F97583">=</span><span style="color:#B392F0"> append</span><span style="color:#E1E4E8">(next, graph[node]</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">            // flush result to client</span></span>
<span class="line"><span style="color:#E1E4E8">            _ </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> call.</span><span style="color:#B392F0">Send</span><span style="color:#E1E4E8">(node)</span></span>
<span class="line"><span style="color:#E1E4E8">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">		current </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> next</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Unlike many previous implementations, this allows the server to progressively navigate the graph.
It keeps server foot prints low, and requires clients to size accordingly for their query.
It improves the latency of calls by reducing round trips between clients and servers.
The was just first pass at implementing such a service.
Throughout the process, I’ve come up other ways to continue improve the performance.
All in all, I’m excited to see how these types of operations scale as the amount of data stored grows.</p>  </article> </div> </main> <footer data-astro-cid-bvzihdzo> <p data-astro-cid-bvzihdzo>&copy; 2025&nbsp;Mya Jaye. All rights reserved.</p> <div class="social-links" data-astro-cid-yxtifmrq> <a href="https://linktr.ee/MsMyaJaye" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>Linktree</span> <svg viewBox="0 0 24 24" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M7.953 15.066c-.08.163-.08.324-.08.486.08.517.528.897 1.052.89h1.294v4.776c0 .486-.404.89-.89.89H6.577a.898.898 0 0 1-.889-.891v-4.774H.992c-.728 0-1.214-.729-.89-1.377l6.96-12.627a1.065 1.065 0 0 1 1.863 0l2.913 5.585-3.885 7.042zm15.945 0-6.96-12.627a1.065 1.065 0 0 0-1.862 0l-2.995 5.586 3.885 7.04c.081.164.081.326.081.487-.08.517-.529.897-1.052.89h-1.296v4.776c.005.49.4.887.89.89h2.914a.9.9 0 0 0 .892-.89v-4.775h4.612c.73 0 1.214-.729.89-1.377z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://github.com/mjpitz" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>GitHub</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://www.linkedin.com/in/mjpitz/" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>LinkedIn</span> <svg viewBox="0 0 50 50" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://twitter.com/MsMyaJaye/" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>Twitter</span> <svg viewBox="0 0 310 310" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M302.973,57.388c-4.87,2.16-9.877,3.983-14.993,5.463c6.057-6.85,10.675-14.91,13.494-23.73 c0.632-1.977-0.023-4.141-1.648-5.434c-1.623-1.294-3.878-1.449-5.665-0.39c-10.865,6.444-22.587,11.075-34.878,13.783 c-12.381-12.098-29.197-18.983-46.581-18.983c-36.695,0-66.549,29.853-66.549,66.547c0,2.89,0.183,5.764,0.545,8.598 C101.163,99.244,58.83,76.863,29.76,41.204c-1.036-1.271-2.632-1.956-4.266-1.825c-1.635,0.128-3.104,1.05-3.93,2.467 c-5.896,10.117-9.013,21.688-9.013,33.461c0,16.035,5.725,31.249,15.838,43.137c-3.075-1.065-6.059-2.396-8.907-3.977 c-1.529-0.851-3.395-0.838-4.914,0.033c-1.52,0.871-2.473,2.473-2.513,4.224c-0.007,0.295-0.007,0.59-0.007,0.889 c0,23.935,12.882,45.484,32.577,57.229c-1.692-0.169-3.383-0.414-5.063-0.735c-1.732-0.331-3.513,0.276-4.681,1.597 c-1.17,1.32-1.557,3.16-1.018,4.84c7.29,22.76,26.059,39.501,48.749,44.605c-18.819,11.787-40.34,17.961-62.932,17.961 c-4.714,0-9.455-0.277-14.095-0.826c-2.305-0.274-4.509,1.087-5.294,3.279c-0.785,2.193,0.047,4.638,2.008,5.895 c29.023,18.609,62.582,28.445,97.047,28.445c67.754,0,110.139-31.95,133.764-58.753c29.46-33.421,46.356-77.658,46.356-121.367 c0-1.826-0.028-3.67-0.084-5.508c11.623-8.757,21.63-19.355,29.773-31.536c1.237-1.85,1.103-4.295-0.33-5.998 C307.394,57.037,305.009,56.486,302.973,57.388z" data-astro-cid-yxtifmrq></path> </svg> </a> <a href="https://youtube.com/@MsMyaJaye/" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>YouTube</span> <svg viewBox="0 0 310 310" width="32" height="32" data-astro-cid-yxtifmrq> <g data-astro-cid-yxtifmrq> <path fill="currentColor" d="M297.917,64.645c-11.19-13.302-31.85-18.728-71.306-18.728H83.386c-40.359,0-61.369,5.776-72.517,19.938   C0,79.663,0,100.008,0,128.166v53.669c0,54.551,12.896,82.248,83.386,82.248h143.226c34.216,0,53.176-4.788,65.442-16.527   C304.633,235.518,310,215.863,310,181.835v-53.669C310,98.471,309.159,78.006,297.917,64.645z M199.021,162.41l-65.038,33.991   c-1.454,0.76-3.044,1.137-4.632,1.137c-1.798,0-3.592-0.484-5.181-1.446c-2.992-1.813-4.819-5.056-4.819-8.554v-67.764   c0-3.492,1.822-6.732,4.808-8.546c2.987-1.814,6.702-1.938,9.801-0.328l65.038,33.772c3.309,1.718,5.387,5.134,5.392,8.861   C204.394,157.263,202.325,160.684,199.021,162.41z" data-astro-cid-yxtifmrq></path> </g> </svg> </a> <a href="/rss.xml" target="_blank" data-astro-cid-yxtifmrq> <span class="sr-only" data-astro-cid-yxtifmrq>RSS</span> <svg viewBox="0 0 16 16" aria-hidden="true" width="32" height="32" data-astro-cid-yxtifmrq> <path fill="currentColor" d="M1,5v2c1.081,0,2.128,0.211,3.113,0.628c0.952,0.403,1.808,0.98,2.543,1.715s1.312,1.591,1.715,2.543 C8.789,12.872,9,13.919,9,15h2C11,9.477,6.523,5,1,5z M4,10c-1.105,0-2,0.895-2,2s0.895,2,2,2s2-0.895,2-2S5.105,10,4,10z M1,1v2 c1.621,0,3.192,0.317,4.67,0.942c1.429,0.604,2.712,1.47,3.815,2.573c1.103,1.103,1.968,2.386,2.573,3.815 C12.683,11.808,13,13.379,13,15h2C15,7.268,8.732,1,1,1z" data-astro-cid-yxtifmrq></path> </svg> </a> </div>  </footer> </body></html>